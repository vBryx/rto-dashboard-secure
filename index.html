<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MHC RTO Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            width: 100%;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: white;
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            margin: 0;
            padding: 0;
            overflow-x: hidden; /* Prevent horizontal scroll */
            width: 100%;
            box-sizing: border-box;
        }
        
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            flex: 1;
            width: 100%;
            box-sizing: border-box;
            position: relative;
        }
        
        /* Mobile Override for Full Width */
        @media (max-width: 768px) {
            * {
                margin: 0 !important;
                box-sizing: border-box !important;
            }
            
            html {
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
                overflow-x: hidden !important;
            }
            
            body {
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
                background-color: white !important;
            }
            
            .dashboard-container {
                max-width: none !important;
                margin: 0 !important;
                width: 100% !important;
                padding: 0 !important;
                background: white !important;
            }
            
            .header {
                width: 100% !important;
                margin: 0 !important;
                padding: 15px 10px !important;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                box-sizing: border-box !important;
                z-index: 1001 !important;
            }
        }
        
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            width: 100%;
            box-sizing: border-box;
            flex-shrink: 0;
            margin: 0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
        }
        
        .logo {
            width: 80px;
            height: 80px;
        }
        
        .header-text h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .header-text p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .main-content {
            padding: 30px;
            flex-grow: 1;
            padding-bottom: 80px; /* Reduced space for smaller footer */
            padding-top: 140px; /* Add space for fixed header */
        }
        
        .population-section {
            text-align: center;
            background: #ecf0f1;
            padding: 40px;
            margin-bottom: 30px;
            border-radius: 5px;
        }
        
        .population-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        .population-numbers {
            display: flex;
            justify-content: center;
            gap: 80px;
            align-items: center;
        }
        
        .population-value {
            font-size: 48px;
            font-weight: bold;
            color: #2c3e50;
            min-width: 200px;
            text-align: center;
        }
        
        .population-percentage {
            font-size: 48px;
            font-weight: bold;
            color: #e74c3c;
        }
        
        .sectors-title {
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 30px;
            color: #2c3e50;
        }
        
        .sectors-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .sector-card {
            background: #ecf0f1;
            padding: 25px;
            border-radius: 5px;
            transition: transform 0.2s ease;
        }
        
        .sector-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .sector-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            color: #2c3e50;
        }
        
        .sector-stats {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 10px;
            font-size: 14px;
        }
        
        .stat-row {
            display: contents;
        }
        
        .stat-label {
            font-weight: 500;
            color: #2c3e50;
        }
        
        .stat-value {
            text-align: right;
            font-weight: bold;
            min-width: 80px;
            display: inline-block;
        }
        
        .stat-percentage {
            text-align: right;
            font-weight: bold;
            color: #3498db;
        }
        
        .footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 12px;
            font-size: 18px;
            font-weight: 500;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100vw;
            flex-shrink: 0; /* Prevent footer from shrinking */
            box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
            z-index: 1000;
            min-height: auto; /* Remove minimum height */
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
        }
        
        /* Mobile Responsive Design */
        @media (max-width: 768px) {
            body {
                margin: 0 !important;
                padding: 0 !important;
            }
            
            .logo {
                width: 50px;
                height: 50px;
                flex-shrink: 0;
            }
            
            .header-text {
                flex: 1;
                min-width: 0;
            }
            
            .header-text h1 {
                font-size: 18px;
                margin-bottom: 5px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            .header-text p {
                font-size: 11px;
                margin: 0;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            .main-content {
                padding: 20px 0px;
                padding-bottom: 60px; /* Reduced space for smaller footer */
                padding-top: 100px; /* Add space for fixed header */
            }
            
            .footer {
                padding: 10px;
                font-size: 16px;
                font-weight: 500;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                width: 100vw;
                margin: 0;
                flex-shrink: 0;
                box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
                z-index: 1000;
            }
            
            .population-section {
                padding: 30px 0px;
            }
            
            .overview-metrics {
                grid-template-columns: 1fr;
                gap: 15px;
                margin-top: 25px;
                margin-bottom: 25px;
            }
            
            .charts-section {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .dashboard-container {
                min-height: 100vh;
                display: flex;
                flex-direction: column;
            }
        }
        
        @media (max-width: 480px) {
            * {
                margin: 0 !important;
                box-sizing: border-box !important;
            }
            
            body {
                margin: 0 !important;
                padding: 0 !important;
            }
            
            .header {
                width: 100% !important;
                margin: 0 !important;
                padding: 12px 8px !important;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                box-sizing: border-box !important;
                gap: 12px;
                z-index: 1001 !important;
            }
            
            .logo {
                width: 40px;
                height: 40px;
                flex-shrink: 0;
            }
            
            .header-text h1 {
                font-size: 16px;
                margin-bottom: 3px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            .header-text p {
                font-size: 10px;
                margin: 0;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            .main-content {
                padding: 15px 0px;
                padding-bottom: 50px; /* Reduced space for smaller footer */
                padding-top: 80px; /* Add space for fixed header */
            }
            
            .footer {
                padding: 8px;
                font-size: 15px;
                font-weight: 500;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                width: 100vw;
                margin: 0;
                flex-shrink: 0;
                box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
                z-index: 1000;
            }
            
            .dashboard-container {
                min-height: 100vh;
                display: flex;
                flex-direction: column;
            }
        }
        
        .overview-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
            margin-top: 30px;
        }
        
        .metric-card {
            background: white;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: transform 0.2s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .metric-icon {
            font-size: 24px;
            margin-bottom: 10px;
            color: #3498db;
        }
        
        .metric-value {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
            min-width: 120px;
            text-align: center;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .metric-label {
            font-size: 14px;
            color: #7f8c8d;
            font-weight: 500;
        }
        
        .metric-percentage {
            font-size: 16px;
            font-weight: bold;
            color: #27ae60;
            margin-top: 5px;
        }
        
        .tabs {
            margin-bottom: 20px;
            border-bottom: 2px solid #bdc3c7;
        }
        
        .tab {
            display: inline-block;
            padding: 12px 24px;
            background: #ecf0f1;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            margin-right: 5px;
        }
        
        .tab.active {
            background: #2c3e50;
            color: white;
        }
        
        .tab-content {
            display: none;
            margin-top: 25px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .charts-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        .chart-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #bdc3c7;
            height: 400px;
        }
        
        .chart-container {
            height: 320px;
            position: relative;
        }
        
        .chart-title {
            text-align: center;
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 18px;
            font-weight: bold;
        }
        @media (max-width: 768px) {
            .sectors-grid {
                grid-template-columns: 1fr;
            }
            
            .population-numbers {
                flex-direction: column;
                gap: 20px;
            }
            
            .overview-metrics {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="header">
            <img src="logo.png" alt="MHC Logo" class="logo">
            <div class="header-text">
                <h1>Reverse The Odds</h1>
                <p>Makkah Health Cluster - Primary Healthcare</p>
            </div>
        </div>
        
        <div class="main-content">
            <div class="tabs">
                <button class="tab active" onclick="showTab('overview')">Overview</button>
                <button class="tab" onclick="showTab('sectors')">Performance by Sectors</button>
            </div>
            
            <div id="overview" class="tab-content active">
                <div class="overview-metrics">
                    <div class="metric-card">
                        <div class="metric-icon"><i class="fas fa-users"></i></div>
                        <div class="metric-value" id="total-population">Loading...</div>
                        <div class="metric-label">Total Population At Risk</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon"><i class="fas fa-hospital"></i></div>
                        <div class="metric-value" id="total-phc">Loading...</div>
                        <div class="metric-label">PHC Centers</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon"><i class="fas fa-phone"></i></div>
                        <div class="metric-value" id="total-communicated">Loading...</div>
                        <div class="metric-label">Successfully Reached</div>
                        <div class="metric-percentage" id="comm-rate">-%</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon"><i class="fas fa-handshake"></i></div>
                        <div class="metric-value" id="total-accepted">Loading...</div>
                        <div class="metric-label">Agreed to Participate</div>
                        <div class="metric-percentage" id="accept-rate">-%</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon"><i class="fas fa-walking"></i></div>
                        <div class="metric-value" id="total-arrived">Loading...</div>
                        <div class="metric-label">Actually Showed Up</div>
                        <div class="metric-percentage" id="arrive-rate">-%</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon"><i class="fas fa-user-check"></i></div>
                        <div class="metric-value" id="total-enrolled">Loading...</div>
                        <div class="metric-label">Successfully Enrolled</div>
                        <div class="metric-percentage" id="enroll-rate">-%</div>
                    </div>
                </div>
            </div>
            
            <div id="sectors" class="tab-content">
                <div class="population-section">
                    <div class="population-title">Total Population At Risk</div>
                    <div class="population-numbers">
                        <div class="population-value" id="sectors-total-population">Loading...</div>
                        <div class="population-percentage" id="sectors-comm-rate">-%</div>
                    </div>
                </div>
                
                <div class="sectors-title">Performance by Sectors</div>
                
                <div class="sectors-grid">
                    <div class="sector-card">
                        <div class="sector-title">Western Sector</div>
                        <div class="sector-stats">
                            <div class="stat-label">Total Population</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage"></div>
                            
                            <div class="stat-label">Communicated</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Accepted</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Refused</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Wrong Number</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">No Response</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">In-person Visits</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Virtual Visits</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Arrived</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Enrolled</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                        </div>
                    </div>
                    
                    <div class="sector-card">
                        <div class="sector-title">Eastern Sector</div>
                        <div class="sector-stats">
                            <div class="stat-label">Total Population</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage"></div>
                            
                            <div class="stat-label">Communicated</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Accepted</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Refused</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Wrong Number</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">No Response</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">In-person Visits</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Virtual Visits</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Arrived</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Enrolled</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                        </div>
                    </div>
                    
                    <div class="sector-card">
                        <div class="sector-title">Northern Sector</div>
                        <div class="sector-stats">
                            <div class="stat-label">Total Population</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage"></div>
                            
                            <div class="stat-label">Communicated</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Accepted</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Refused</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Wrong Number</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">No Response</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">In-person Visits</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Virtual Visits</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Arrived</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Enrolled</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                        </div>
                    </div>
                    
                    <div class="sector-card">
                        <div class="sector-title">Southern Sector</div>
                        <div class="sector-stats">
                            <div class="stat-label">Total Population</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage"></div>
                            
                            <div class="stat-label">Communicated</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Accepted</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Refused</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Wrong Number</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">No Response</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">In-person Visits</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Virtual Visits</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Arrived</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                            
                            <div class="stat-label">Enrolled</div>
                            <div class="stat-value">Loading...</div>
                            <div class="stat-percentage">-%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            Monitored and Operated by: Dr. Hamoud Almatrafi
        </div>
    </div>

    <script>
        function showTab(tabName) {
            // Hide all tab contents
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected content and activate tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Load real data when available
        function loadDashboardData() {
            // Add cache busting parameter to force fresh data
            const timestamp = new Date().getTime();
            const url = `dashboard_data.json?t=${timestamp}`;
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.overview) {
                        const overview = data.overview;
                        
                        // Update overview metrics with proper percentages
                        document.getElementById('total-population').textContent = overview.total_population?.toLocaleString() || '52,308';
                        document.getElementById('total-phc').textContent = overview.total_phc_centers?.toLocaleString() || '116';
                        document.getElementById('total-communicated').textContent = overview.total_communicated?.toLocaleString() || '3,694';
                        document.getElementById('total-accepted').textContent = overview.total_accepted?.toLocaleString() || '1,408';
                        document.getElementById('total-arrived').textContent = overview.total_arrived?.toLocaleString() || '346';
                        document.getElementById('total-enrolled').textContent = overview.total_enrolled?.toLocaleString() || '341';
                        
                        // Calculate meaningful percentages
                        const commRate = overview.total_population > 0 ? 
                            ((overview.total_communicated / overview.total_population) * 100).toFixed(2) : '7.1';
                        
                        const acceptRate = overview.total_communicated > 0 ? 
                            ((overview.total_accepted / overview.total_communicated) * 100).toFixed(1) : '38.1';
                        
                        const arriveRate = overview.total_accepted > 0 ? 
                            ((overview.total_arrived / overview.total_accepted) * 100).toFixed(1) : '24.6';
                        
                        const enrollRate = overview.total_arrived > 0 ? 
                            ((overview.total_enrolled / overview.total_arrived) * 100).toFixed(1) : '98.6';
                        
                        // Update overview percentages with simple colors
                        const commRateElement = document.getElementById('comm-rate');
                        const acceptRateElement = document.getElementById('accept-rate');
                        const arriveRateElement = document.getElementById('arrive-rate');
                        const enrollRateElement = document.getElementById('enroll-rate');
                        
                        commRateElement.textContent = commRate + '%';
                        commRateElement.style.color = getPercentageColor(parseFloat(commRate));
                        
                        acceptRateElement.textContent = acceptRate + '%';
                        acceptRateElement.style.color = getPercentageColor(parseFloat(acceptRate));
                        
                        arriveRateElement.textContent = arriveRate + '%';
                        arriveRateElement.style.color = getPercentageColor(parseFloat(arriveRate));
                        
                        enrollRateElement.textContent = enrollRate + '%';
                        enrollRateElement.style.color = getPercentageColor(parseFloat(enrollRate));
                        
                        // Update sectors tab values as well (NO COLORS - just text)
                        document.getElementById('sectors-total-population').textContent = overview.total_population?.toLocaleString() || '52,308';
                        document.getElementById('sectors-comm-rate').textContent = commRate + '%';
                        
                        console.log('Dashboard data updated:', {
                            population: overview.total_population,
                            communicated: overview.total_communicated,
                            rate: commRate + '%',
                            timestamp: new Date().toLocaleTimeString()
                        });
                    }
                    
                    // Update sector data dynamically
                    if (data.sectors) {
                        updateSectorData(data.sectors);
                    }
                })
                .catch(error => {
                    console.log('Using default data - server not running:', error);
                });
        }
        
        // Initial load
        loadDashboardData();
        
        // Auto-refresh every 2 minutes for cost optimization (reduced from 30 seconds)
        setInterval(loadDashboardData, 120000);
        
        function getPercentageColor(percentage) {
            // Simple color logic ONLY for overview tab
            if (percentage >= 70) return '#27ae60'; // Green
            if (percentage >= 40) return '#f39c12'; // Orange
            return '#e74c3c'; // Red
        }
            
        function updateSectorData(sectors) {
            // Define sector order to match HTML structure
            const sectorOrder = ['western', 'eastern', 'northern', 'southern'];
            const sectorCards = document.querySelectorAll('.sector-card');
            
            sectorOrder.forEach((sectorName, index) => {
                if (sectors[sectorName] && sectorCards[index]) {
                    const card = sectorCards[index];
                    const statValues = card.querySelectorAll('.stat-value');
                    const statPercentages = card.querySelectorAll('.stat-percentage');
                    const phcs = sectors[sectorName];
                    
                    // Calculate sector totals
                    const totals = {
                        population: phcs.reduce((sum, phc) => sum + phc.total_population, 0),
                        communicated: phcs.reduce((sum, phc) => sum + phc.communicated, 0),
                        accepted: phcs.reduce((sum, phc) => sum + phc.accepted, 0),
                        refused: phcs.reduce((sum, phc) => sum + phc.refused, 0),
                        wrongNumber: phcs.reduce((sum, phc) => sum + phc.wrong_number, 0),
                        noResponse: phcs.reduce((sum, phc) => sum + phc.no_response, 0),
                        inPerson: phcs.reduce((sum, phc) => sum + phc.in_person_visits, 0),
                        virtual: phcs.reduce((sum, phc) => sum + phc.virtual_visits, 0),
                        arrived: phcs.reduce((sum, phc) => sum + phc.arrived, 0),
                        enrolled: phcs.reduce((sum, phc) => sum + phc.enrolled, 0)
                    };
                    
                    // Update values
                    if (statValues.length >= 10) {
                        statValues[0].textContent = totals.population.toLocaleString();
                        statValues[1].textContent = totals.communicated.toLocaleString();
                        statValues[2].textContent = totals.accepted.toLocaleString();
                        statValues[3].textContent = totals.refused.toLocaleString();
                        statValues[4].textContent = totals.wrongNumber.toLocaleString();
                        statValues[5].textContent = totals.noResponse.toLocaleString();
                        statValues[6].textContent = totals.inPerson.toLocaleString();
                        statValues[7].textContent = totals.virtual.toLocaleString();
                        statValues[8].textContent = totals.arrived.toLocaleString();
                        statValues[9].textContent = totals.enrolled.toLocaleString();
                    }
                    
                    // Update percentages - SIMPLE ORIGINAL LOGIC
                    if (statPercentages.length >= 10) {
                        // Communication rate
                        const commPercent = totals.population > 0 ? 
                            Math.round((totals.communicated / totals.population) * 100) : 0;
                        statPercentages[1].textContent = commPercent + '%';
                        
                        // Acceptance rate
                        const acceptPercent = totals.communicated > 0 ? 
                            Math.round((totals.accepted / totals.communicated) * 100) : 0;
                        statPercentages[2].textContent = acceptPercent + '%';
                        
                        // Refusal rate
                        const refusePercent = totals.communicated > 0 ? 
                            Math.round((totals.refused / totals.communicated) * 100) : 0;
                        statPercentages[3].textContent = refusePercent + '%';
                        
                        // Wrong number rate
                        const wrongPercent = totals.communicated > 0 ? 
                            Math.round((totals.wrongNumber / totals.communicated) * 100) : 0;
                        statPercentages[4].textContent = wrongPercent + '%';
                        
                        // No response rate
                        const noResponsePercent = totals.communicated > 0 ? 
                            Math.round((totals.noResponse / totals.communicated) * 100) : 0;
                        statPercentages[5].textContent = noResponsePercent + '%';
                        
                        const totalVisits = totals.inPerson + totals.virtual;
                        // In-person visit percentage
                        const inPersonPercent = totalVisits > 0 ? 
                            Math.round((totals.inPerson / totalVisits) * 100) : 0;
                        statPercentages[6].textContent = inPersonPercent + '%';
                        
                        // Virtual visit percentage
                        const virtualPercent = totalVisits > 0 ? 
                            Math.round((totals.virtual / totalVisits) * 100) : 0;
                        statPercentages[7].textContent = virtualPercent + '%';
                        
                        // Arrival rate
                        const arrivalPercent = totals.accepted > 0 ? 
                            Math.round((totals.arrived / totals.accepted) * 100) : 0;
                        statPercentages[8].textContent = arrivalPercent + '%';
                        
                        // Enrollment percentage - use proper index
                        const enrollPercent = totals.arrived > 0 ? 
                            Math.round((totals.enrolled / totals.arrived) * 100) : 0;
                        if (statPercentages[9]) {
                            statPercentages[9].textContent = enrollPercent + '%';
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
